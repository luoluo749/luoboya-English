<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è‰¾å®¾æµ©æ–¯10æ¬¡å¤ä¹ è®¡åˆ’ç”Ÿæˆå™¨</title>
    <style>
        body { font-family: å¾®è½¯é›…é»‘; padding: 20px; background-color: #f9f3e9; margin: 0; }
        .box { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px #ddd; max-width: 800px; margin: 0 auto; }
        h1 { color: #e67e22; text-align: center; font-size: 24px; margin-top: 0; }
        .today-review { background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffc107; }
        .today-title { color: #856404; font-weight: bold; margin-bottom: 10px; font-size: 16px; }
        .today-item { color: #721c24; margin: 5px 0; font-size: 15px; }
        .no-today { color: #6c757d; font-size: 14px; }
        .input-area { margin: 20px 0; padding: 15px; background: #fef5e7; border-radius: 8px; }
        input, textarea { padding: 10px; margin: 10px 5px; border: 2px solid #e67e22; border-radius: 5px; box-sizing: border-box; }
        #planName { width: 300px; }
        #startDate { width: 200px; }
        #wordInput { width: 500px; height: 100px; resize: none; }
        button { padding: 10px 20px; background: #e67e22; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; transition: background 0.3s; }
        button:hover { background: #d35400; }
        .plan-item { margin: 15px 0; padding: 15px; background: #fef5e7; border-radius: 8px; border-left: 4px solid #e67e22; }
        .review-day { margin: 6px 0; color: #333; font-size: 14px; }
        .title { color: #e67e22; font-weight: bold; margin-bottom: 10px; font-size: 16px; }
        .tip { color: #666; font-size: 13px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="box">
        <h1>ğŸ“š è‰¾å®¾æµ©æ–¯10æ¬¡å¤ä¹ è®¡åˆ’ç”Ÿæˆå™¨</h1>

        <!-- ä»Šæ—¥å¤ä¹ åŒº -->
        <div class="today-review">
            <div class="today-title">ğŸ“… ä»Šå¤©ï¼ˆ<span id="localToday"></span>ï¼‰è¦å¤ä¹ çš„å†…å®¹ï¼š</div>
            <div id="todayReviewList" class="no-today">æ­£åœ¨åŠ è½½å¤ä¹ è®¡åˆ’...</div>
        </div>

        <!-- æ ¸å¿ƒæ“ä½œåŒº -->
        <div class="input-area">
            <h3>1. æ·»åŠ æ–°è¯¾ç¨‹è®¡åˆ’</h3>
            <p>è¯¾ç¨‹åç§°ï¼ˆå¦‚"äº”å¹´çº§æ•°å­¦ç¬¬1ç« "ï¼‰ï¼š</p>
            <input type="text" id="planName" placeholder="å¿…å¡«ï¼šè¾“å…¥è¯¾ç¨‹å" required>
            <p>å¼€å§‹å­¦ä¹ æ—¥æœŸï¼š</p>
            <input type="date" id="startDate" required>
            <p>å•è¯ï¼ˆæ¯è¡Œ1ç»„ï¼šè‹±æ–‡+ç©ºæ ¼+ä¸­æ–‡ï¼Œæ— åˆ™ä¸å¡«ï¼‰ï¼š</p>
            <textarea id="wordInput" placeholder="ç¤ºä¾‹ï¼šapple è‹¹æœ&#10;banana é¦™è•‰"></textarea>
            <br>
            <button onclick="addNewPlan()">æ·»åŠ è®¡åˆ’</button>

            <h3 style="margin-top: 20px;">2. å¯¼å‡ºåŠŸèƒ½</h3>
            <button onclick="exportAllPlans()">å¯¼å‡ºå…¨éƒ¨è®¡åˆ’ä¸ºTXT</button>
        </div>

        <!-- è¯¾ç¨‹è®¡åˆ’å±•ç¤ºåŒº -->
        <div id="allPlans"></div>
    </div>

    <script>
        const reviewIntervals = [1, 2, 3, 5, 7, 9, 12, 14, 17, 21]; // 10æ¬¡å¤ä¹ é—´éš”ï¼ˆä»å¼€å§‹æ—¥ç®—èµ·çš„å¤©æ•°ï¼‰
        const PLAN_KEY = "reviewPlans";
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayStr = getLocalDateStr(today);

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºä»Šæ—¥æ—¥æœŸå¹¶åŠ è½½è®¡åˆ’
        window.onload = () => {
            document.getElementById('localToday').textContent = todayStr;
            loadAllPlans();
        };

        // æ—¥æœŸæ ¼å¼åŒ–å·¥å…·
        function getLocalDateStr(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}-${month}-${day}`;
        }

        // æ·»åŠ æ–°è¯¾ç¨‹è®¡åˆ’
        function addNewPlan() {
            const planName = document.getElementById("planName").value.trim();
            const startDate = document.getElementById("startDate").value;
            const wordInput = document.getElementById("wordInput").value.trim();

            if (!planName || !startDate) {
                alert("è¯¾ç¨‹åå’Œå¼€å§‹æ—¥æœŸä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            // è§£æå•è¯
            const words = [];
            if (wordInput) {
                wordInput.split('\n').forEach(line => {
                    line = line.trim();
                    if (!line) return;
                    const [eng, ...cnParts] = line.split(' ');
                    const cn = cnParts.join(' ').trim();
                    if (eng && cn) {
                        words.push({ eng, cn });
                    }
                });
            }

            // ç”Ÿæˆ10æ¬¡å¤ä¹ æ—¥æœŸ - ä¿®å¤ç‰ˆé€»è¾‘
            const startDateObj = new Date(startDate);
            startDateObj.setHours(0, 0, 0, 0);

            const newPlan = {
                id: Date.now(),
                name: planName,
                startDate: startDate,
                words: words,
                reviews: reviewIntervals.map((daysFromStart, i) => {
                    const reviewDate = new Date(startDateObj);
                    reviewDate.setDate(reviewDate.getDate() + daysFromStart); // ç›´æ¥åœ¨å¼€å§‹æ—¥æœŸä¸ŠåŠ å¤©æ•°
                    return {
                        times: i + 1,
                        date: getLocalDateStr(reviewDate),
                        interval: daysFromStart
                    };
                })
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const allPlans = JSON.parse(localStorage.getItem(PLAN_KEY) || "[]");
            allPlans.push(newPlan);
            localStorage.setItem(PLAN_KEY, JSON.stringify(allPlans));

            // åˆ·æ–°é¡µé¢æ˜¾ç¤º
            loadAllPlans();
            clearInput();
            alert(`"${planName}"è®¡åˆ’æ·»åŠ æˆåŠŸï¼å·²åœ¨ä¸‹æ–¹æ˜¾ç¤ºã€‚`);
        }

        // åŠ è½½å¹¶æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’
        function loadAllPlans() {
            const allPlans = JSON.parse(localStorage.getItem(PLAN_KEY) || "[]");
            const allPlansContainer = document.getElementById("allPlans");
            allPlansContainer.innerHTML = "";

            if (allPlans.length === 0) {
                allPlansContainer.innerHTML = `<p class="no-today">æš‚æ— è¯¾ç¨‹è®¡åˆ’ï¼Œå¯ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ è®¡åˆ’"åˆ›å»º</p>`;
                updateTodayReviewList([]);
                return;
            }

            // æ›´æ–°ä»Šæ—¥å¤ä¹ åˆ—è¡¨
            updateTodayReviewList(allPlans);

            // æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’
            allPlans.forEach(plan => {
                const planItem = document.createElement("div");
                planItem.className = "plan-item";

                let reviewHtml = "";
                plan.reviews.forEach(review => {
                    const isToday = review.date === todayStr;
                    const isPast = new Date(review.date) < today;
                    let statusStyle = "";
                    if (isToday) statusStyle = "color:#e67e22;font-weight:bold";
                    if (isPast) statusStyle = "color:#6c757d;text-decoration:line-through";
                    reviewHtml += `<div class="review-day"><span style="${statusStyle}">ç¬¬${review.times}æ¬¡ï¼š${review.date}</span>ï¼ˆè·å¼€å§‹ç¬¬${review.interval}å¤©ï¼‰</div>`;
                });

                let wordInfo = "";
                if (plan.words.length > 0) {
                    wordInfo = `<div class="tip">å•è¯æ€»æ•°ï¼š${plan.words.length} ä¸ª</div>`;
                } else {
                    wordInfo = `<div class="tip">æœ¬è¯¾ç¨‹æœªæ·»åŠ å•è¯</div>`;
                }

                planItem.innerHTML = `
                    <div class="title">ğŸ“š ${plan.name}ï¼ˆå¼€å§‹æ—¥æœŸï¼š${plan.startDate}ï¼‰</div>
                    <div>${reviewHtml}</div>
                    ${wordInfo}
                `;
                allPlansContainer.appendChild(planItem);
            });
        }

        // æ›´æ–°ä»Šæ—¥å¤ä¹ åˆ—è¡¨
        function updateTodayReviewList(allPlans) {
            const todayReviewList = document.getElementById("todayReviewList");
            const todayPlans = allPlans.filter(plan => 
                plan.reviews.some(review => review.date === todayStr)
            );

            if (todayPlans.length === 0) {
                todayReviewList.innerHTML = "ä»Šæ—¥æš‚æ— å¤ä¹ ä»»åŠ¡ï¼Œå¥½å¥½ä¼‘æ¯å§ï¼";
                todayReviewList.className = "no-today";
                return;
            }

            todayReviewList.className = "";
            let todayHtml = "";
            todayPlans.forEach(plan => {
                todayHtml += `<div class="today-item">â€¢ ${plan.name}ï¼ˆç¬¬${plan.reviews.find(r => r.date === todayStr).times}æ¬¡å¤ä¹ ï¼‰</div>`;
            });
            todayReviewList.innerHTML = todayHtml;
        }

        // å¯¼å‡ºå…¨éƒ¨è®¡åˆ’ä¸ºTXT
        function exportAllPlans() {
            const allPlans = JSON.parse(localStorage.getItem(PLAN_KEY) || "[]");
            if (allPlans.length === 0) {
                alert("æ²¡æœ‰å¯å¯¼å‡ºçš„è®¡åˆ’ï¼");
                return;
            }

            let txtContent = `=== è‰¾å®¾æµ©æ–¯å¤ä¹ è®¡åˆ’æ±‡æ€» ===\n`;
            txtContent += `å¯¼å‡ºæ—¥æœŸï¼š${new Date().toLocaleDateString()}\n`;
            txtContent += `æ€»è¯¾ç¨‹æ•°ï¼š${allPlans.length}\n\n`;

            allPlans.forEach(plan => {
                txtContent += `=== ${plan.name} ===\n`;
                txtContent += `å¼€å§‹æ—¥æœŸï¼š${plan.startDate}\n`;
                txtContent += `å¤ä¹ æ¬¡æ•°ï¼š10æ¬¡\n\n`;

                txtContent += `10æ¬¡å¤ä¹ å®‰æ’ï¼š\n`;
                plan.reviews.forEach(review => {
                    txtContent += `  ç¬¬${review.times}æ¬¡ï¼š${review.date}ï¼ˆè·å¼€å§‹ç¬¬${review.interval}å¤©ï¼‰\n`;
                });

                if (plan.words.length > 0) {
                    txtContent += `\nå•è¯åˆ—è¡¨ï¼š\n`;
                    plan.words.forEach(word => {
                        txtContent += `  ${word.eng} ${word.cn}\n`;
                    });
                } else {
                    txtContent += `\nå•è¯åˆ—è¡¨ï¼šæ— \n`;
                }
                txtContent += `\n`;
            });

            // ä¸‹è½½TXTæ–‡ä»¶
            const blob = new Blob([txtContent], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `è‰¾å®¾æµ©æ–¯å¤ä¹ è®¡åˆ’æ±‡æ€»_${new Date().toLocaleDateString().replace(/\//g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert("æ‰€æœ‰è®¡åˆ’å·²æˆåŠŸå¯¼å‡ºä¸ºTXTæ–‡ä»¶ï¼");
        }

        // æ¸…ç©ºè¾“å…¥æ¡†
        function clearInput() {
            document.getElementById("planName").value = "";
            document.getElementById("startDate").value = "";
            document.getElementById("wordInput").value = "";
        }
    </script>
</body>
</html>
